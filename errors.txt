from pathlib import Path
from cryptography.fernet import Fernet

# Same paths as encrypt script
OUT_DIR  = Path("/home/tobhel10/Krypteringsprosjekt/OUT")
KEY_FILE = Path("/home/tobhel10/Krypteringsprosjekt/Key.key")

def main():
    # Ask user for the key (copy it from Key.key when testing)
    user_key_input = input("Enter your decryption key: ").strip()

    # Convert user input to bytes
    try:
        user_key = user_key_input.encode()
        f = Fernet(user_key)   # validate key format
    except Exception:
        print("❌ Invalid key format. Decryption refused.")
        return

    # Ask for encrypted filename (must be inside OUT folder)
    encrypted_name = input("Enter encrypted filename (example: secret.txt.enc): ").strip()
    encrypted_path = OUT_DIR / encrypted_name

    if not encrypted_path.exists():
        print(f"❌ File not found: {encrypted_path}")
        return

    # Read encrypted bytes
    encrypted_bytes = encrypted_path.read_bytes()

    try:
        decrypted_bytes = f.decrypt(encrypted_bytes)
    except Exception:
        print("❌ Wrong key. Cannot decrypt.")
        return

    # Remove .enc extension to get original name
    output_path = OUT_DIR / encrypted_name.replace(".enc", "")

    output_path.write_bytes(decrypted_bytes)

    print(f"✅ Decrypted successfully!")
    print(f"Output saved to: {output_path}")

if __name__ == "__main__":
    main()
