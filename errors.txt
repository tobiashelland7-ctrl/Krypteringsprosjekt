from pathlib import Path
from cryptography.fernet import Fernet

DATA_DIR = Path("/home/tobhel10/Krypteringsprosjekt/DATA")
OUT_DIR  = Path("/home/tobhel10/Krypteringsprosjekt/OUT")
KEY_FILE = Path("/home/tobhel10/Krypteringsprosjekt/Key.key")

def load_or_create_key():
    if KEY_FILE.exists():
        return KEY_FILE.read_bytes()
    key = Fernet.generate_key()
    KEY_FILE.write_bytes(key)
    return key

def encrypt_file(input_path: Path, fernet: Fernet):
    # 1. Read the original file as bytes
    data = input_path.read_bytes()

    # 2. Encrypt the bytes
    encrypted = fernet.encrypt(data)

    # 3. Ensure output directory exists
    OUT_DIR.mkdir(parents=True, exist_ok=True)

    # 4. Save encrypted file
    output_path = OUT_DIR / (input_path.name + ".enc")
    output_path.write_bytes(encrypted)

    # 5. DELETE ORIGINAL FILE
    input_path.unlink()  # ‚Üê This removes the original file

    return output_path

def main():
    key = load_or_create_key()
    f = Fernet(key)

    # Put your GIF in DATA/ with this exact name:
    input_file = DATA_DIR / "charlie-kirk-tony-stark.gif"

    output_file = encrypt_file(input_file, f)
    print(f"Encrypted to: {output_file} (original deleted)")

if __name__ == "__main__":
    main()
