from pathlib import Path
from cryptography.fernet import Fernet

# FIXED PATHS ↓↓↓
DATA_DIR = Path("/home/tobhel10/Krypteringsprosjekt/DATA")
OUT_DIR  = Path("/home/tobhel10/Krypteringsprosjekt/OUT")
KEY_FILE = Path("/home/tobhel10/Krypteringsprosjekt/Key.key")
# FIXED PATHS ↑↑↑

def load_or_create_key():
    if KEY_FILE.exists():
        return KEY_FILE.read_bytes()
    key = Fernet.generate_key()
    KEY_FILE.write_bytes(key)
    return key

def encrypt_file(input_path: Path, fernet: Fernet):
    data = input_path.read_bytes()
    encrypted = fernet.encrypt(data)
    OUT_DIR.mkdir(parents=True, exist_ok=True)
    output_path = OUT_DIR / (input_path.name + ".enc")
    output_path.write_bytes(encrypted)
    return output_path

def main():
    key = load_or_create_key()
    f = Fernet(key)

    # Make sure this exact file exists:
    # /home/tobhel10/Krypteringsprosjekt/DATA/i have a hole in my shoes.txt
    input_file = DATA_DIR / "i have a hole in my shoes.txt"

    output_file = encrypt_file(input_file, f)
    print(f"Encrypted to: {output_file}")

if __name__ == "__main__":
    main()
