from pathlib import Path
from cryptography.fernet import Fernet

OUT_DIR = Path("out")
KEY_FILE = Path("key.key")

def load_key():
    # Load the same key used for encryption
    return KEY_FILE.read_bytes()

def decrypt_file(encrypted_path: Path, fernet: Fernet):
    # Read encrypted bytes
    encrypted = encrypted_path.read_bytes()

    # Decrypt
    decrypted = fernet.decrypt(encrypted)

    # Remove .enc extension
    output_path = encrypted_path.with_suffix("")
    output_path.write_bytes(decrypted)
    return output_path

def main():
    key = load_key()
    f = Fernet(key)

    encrypted_file = OUT_DIR / "secret.txt.enc"  # change if needed
    restored_path = decrypt_file(encrypted_file, f)

    print(f"Decrypted to: {restored_path}")

if __name__ == "__main__":
    main()
