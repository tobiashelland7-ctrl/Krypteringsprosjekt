from pathlib import Path
from cryptography.fernet import Fernet

OUT_DIR  = Path("/home/tobhel10/Krypteringsprosjekt/OUT")

def main():
    # Ask user for the key
    user_key_input = input("Enter your decryption key: ").strip()

    try:
        f = Fernet(user_key_input.encode())
    except Exception:
        print("‚ùå Invalid key format.")
        return

    # Ask which encrypted file to decrypt
    encrypted_name = input("Enter encrypted filename (example: charlie-kirk-tony-stark.gif.enc): ").strip()
    encrypted_path = OUT_DIR / encrypted_name

    if not encrypted_path.exists():
        print("‚ùå File not found:", encrypted_path)
        return

    # Try decrypting
    try:
        encrypted_bytes = encrypted_path.read_bytes()
        decrypted_bytes = f.decrypt(encrypted_bytes)
    except Exception:
        print("‚ùå Wrong key. Cannot decrypt.")
        return

    # Remove .enc extension ‚Üí restore original GIF name
    output_path = OUT_DIR / encrypted_name.replace(".enc", "")

    # Write the decrypted GIF bytes
    output_path.write_bytes(decrypted_bytes)

    print(f"‚úÖ Decrypted: {output_path}")

    # Delete encrypted file
    encrypted_path.unlink()
    print(f"üóë Deleted encrypted file: {encrypted_path}")

if __name__ == "__main__":
    main()
